<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/custom-style.html">
<link rel="import" href="../../bower_components/vaadin-themable-mixin/vaadin-themable-mixin.html">

<script src="../../../../../webjars/apexcharts/3.8.0/dist/apexcharts.js"></script>
<script src="../../../../../webjars/onecolor/3.0.5/one-color.js"></script>
<dom-module id="apex-charts-wrapper">
    <template>
        <style>
            ::slotted(div) {
                overflow: hidden;
            }
        </style>
        <slot></slot>
    </template>
    <script>
        class ApexChartsWrapper extends Vaadin.ThemableMixin(Polymer.Element){
            static get is(){
                return 'apex-charts-wrapper'
            }

            static get properties(){
                return {
                    annotations: {
                        type: Object
                    }, // ApexAnnotations;
                    chart: {
                        type: Object
                    }, // ApexChart;
                    colors: {
                        type: Object
                    }, // string[];
                    dataLabels: {
                        type: Object
                    }, // ApexDataLabels;
                    fill: {
                        type: Object
                    }, // ApexFill;
                    grid: {
                        type: Object
                    }, // ApexGrid;
                    labels: {
                        type: Object
                    }, // string[];
                    legend: {
                        type: Object
                    }, // ApexLegend;
                    markers: {
                        type: Object
                    }, // ApexMarkers;
                    noData: {
                        type: Object
                    }, // ApexNoData;
                    plotOptions: {
                        type: Object
                    }, // ApexPlotOptions;
                    responsive: {
                        type: Object
                    }, // ApexResponsive[];
                    series: {
                        type: Object
                    }, // ApexAxisChartSeries | ApexNonAxisChartSeries;
                    states: {
                        type: Object
                    }, // ApexStates;
                    stroke: {
                        type: Object
                    }, // ApexStroke;
                    subtitle: {
                        type: Object
                    }, // ApexTitleSubtitle;
                    theme: {
                        type: Object
                    }, // ApexTheme;
                    chartTitle: {
                        type: Object
                    }, // ApexTitleSubtitle;
                    tooltip: {
                        type: Object
                    }, // ApexTooltip;
                    xaxis: {
                        type: Object
                    }, // ApexXAxis;
                    yaxis: {
                        type: Object
                    }, // ApexYAxis | ApexYAxis[];
                    width: {
                        type: String
                    },
                    height: {
                        type: String
                    }
                }
            }

            ready(){
                super.ready();
                var div = document.createElement('div');
                this.appendChild(div);
                this.updateConfig();
                this.chart = new ApexCharts(div, this.config);
                this.chart.render();
            }

            updateConfig(){
                var primaryColor;
                if (ShadyCSS) {
                    primaryColor = ShadyCSS.getComputedStyleValue(this, '--apex-charts-primary-color');
                } else {
                    primaryColor = getComputedStyle(this).getPropertyValue('--apex-charts-primary-color');
                }
                var backgroundColor;
                if (ShadyCSS) {
                    backgroundColor = ShadyCSS.getComputedStyleValue(this, '--apex-charts-background-color');
                } else {
                    backgroundColor = getComputedStyle(this).getPropertyValue('--apex-charts-background-color');
                }
                this.config = {};
                if (this.annotations) {
                    this.config.annotations = this.annotations;
                }
                if (this.chart) {
                    this.config.chart = JSON.parse(this.chart);
                }
                if (this.series) {
                    this.config.series = JSON.parse(this.series);
                }
                if (this.labels) {
                    this.config.labels = this.labels;
                }
                if (this.colors) {
                    this.config.colors = JSON.parse(this.colors);
                }
                if (this.dataLabels) {
                    this.config.dataLabels = JSON.parse(this.dataLabels);
                }
                if (this.fill) {
                    this.config.fill = JSON.parse(this.fill);
                }
                if (this.grid) {
                    this.config.grid = JSON.parse(this.grid);
                }
                if (this.legend) {
                    this.config.legend = JSON.parse(this.legend);
                }
                if (this.markers) {
                    this.config.markers = this.markers;
                }
                if (this.noData) {
                    this.config.noData = this.noData;
                }
                if (this.plotOptions) {
                    this.config.plotOptions = JSON.parse(this.plotOptions);
                }
                if (this.responsive) {
                    this.config.responsive = JSON.parse(this.responsive);
                }
                if (this.states) {
                    this.config.states = this.states;
                }
                if (this.stroke) {
                    this.config.stroke = JSON.parse(this.stroke);
                }
                if (this.subtitle) {
                    this.config.subtitle = JSON.parse(this.subtitle);
                }
                if (this.theme) {
                    this.config.theme = this.theme;
                } else {
                    this.config.theme = {
                        mode: ((one.color(backgroundColor).lightness() > 0.5) ? 'light' : 'dark'),
                        monochrome: {
                            enabled: true,
                            color: one.color(primaryColor).hex(),
                            shadeTo: 'light',
                            shadeIntensity: 0.65
                        }
                    }
                }
                if (this.chartTitle) {
                    this.config.title = JSON.parse(this.chartTitle);
                }
                if (this.tooltip) {
                    this.config.tooltip = JSON.parse(this.tooltip);
                }
                if (this.xaxis) {
                    this.config.xaxis = JSON.parse(this.xaxis);
                }
                if (this.yaxis) {
                    this.config.yaxis = JSON.parse(this.yaxis);
                }
                if (!this.config.chart) {
                    this.config.chart = {};
                }
                if (this.width) {
                    this.config.chart.width = this.width;
                }
                if (this.height) {
                    this.config.chart.height = this.height;
                }
                if(!this.config.chart.background){
                    this.config.chart.background = backgroundColor;
                }
                if (!this.config.stroke) {
                    this.config.stroke = {};
                }
            }
            render(){
                if (this.chart){
                    this.updateConfig();
                    this.chart.render();
                }
            }
        }
        customElements.define(ApexChartsWrapper.is, ApexChartsWrapper);
    </script>
</dom-module>
